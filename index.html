<!doctype HTML>
<html>
    <head>
        <title>Youtube Music</title>
        <meta charset="utf-8">
        <link rel="manifest" href="manifest.json">
        <link rel="shortcut icon" href="images/youzic.ico">
        <link rel="apple-touch-icon" href="images/youzic-512.png">
        <link rel="stylesheet" href="css/base.css" type="text/css">
        <link rel="stylesheet" href="css/editor.css" type="text/css">
        <link rel="stylesheet" href="css/swiper-bundle.min.css" type="text/css">
        <script src="js/jquery-3.7.1.min.js"></script>
        <script src="js/sweetalert2.all.min.js"></script>
        <script src="js/sw-main.js"></script>
        <script src="https://www.youtube.com/iframe_api"></script>
        <script src="js/players.js"></script>
        <script src="js/swiper-bundle.min.js"></script>
        <script src="js/indexedDB.js"></script>
        <script src="js/editor.js"></script>
        <script src="js/user.js"></script>
        <script src="js/wakeLock.js"></script>
    </head>
    <body>
        <div class="video-container" id="videoPlayer">
            <!-- Le lecteur vid√©o ou audio sera charg√© ici -->
        </div>
        
        <!-- Contr√¥les d'√©dition (nouveau) -->
        <div class="edit-controls-top">
            <button id="editModeBtn" class="edit-control-btn" title="Mode √©dition">‚úèÔ∏è</button>
            <button id="addItemBtn" class="edit-control-btn" title="Ajouter (d√©tection auto)" onclick="addNewItem()">‚ûï</button>
        </div>
        
        <!-- partie slidable -->
        <div class="swiper">
            <!-- Additional required wrapper -->
            <div class="swiper-wrapper">
                <!-- Slides -->
                <div class="swiper-slide">
                    <!-- Page 1 -->
                    <div class="liste1">
                        <!-- Boutons pour lire les vid√©os seront plac√©s ici-->
                        <!-- Animation de chargement-->
                        <span id="loader" class="loader">
                            <span class="loader-inner"></span>
                        </span>
                    </div>
                    <!-- fin page 1 -->
                </div>
                <div class="swiper-slide">
                    <!-- Page 2 -->
                    <div class="liste2">
                        <!-- Boutons pour lire les web radios seront plac√©s ici-->
                    </div>
                    <!-- fin page 2-->
                </div>    
                <div class="swiper-slide">    
                    <!-- Page 3 -->
                    <div class="liste3">
                        <!-- Boutons pour lire les playlist youtube seront plac√©s ici-->
                    </div>
                    <!-- fin page 3-->
                </div>
            </div>
        </div>
        <script src="js/swiper-conf.js"></script>
        <script>
            // Fonction pour d√©tecter quelle liste est visible
            function getVisibleList() {
                console.log('=== GET VISIBLE LIST ===');
                const slides = document.querySelectorAll('.swiper-slide');
                console.log('Nombre de slides trouv√©es:', slides.length);
                
                for (let i = 0; i < slides.length; i++) {
                    const slide = slides[i];
                    const hasVisible = slide.classList.contains('swiper-slide-visible');
                    const slideIndex = slide.getAttribute('data-swiper-slide-index');
                    console.log(`Slide ${i}: data-swiper-slide-index=${slideIndex}, swiper-slide-visible=${hasVisible}`);
                    
                    // Utiliser swiper-slide-visible au lieu de swiper-slide-active
                    if (hasVisible) {
                        const index = parseInt(slideIndex);
                        console.log('‚úÖ Slide visible d√©tect√©e! Index:', index);
                        
                        const listMapping = [
                            { key: 'youtubeChannels', class: '.liste1', index: 0 },
                            { key: 'radioStations', class: '.liste2', index: 1 },
                            { key: 'youtubePlaylists', class: '.liste3', index: 2 }
                        ];
                        
                        const result = listMapping[index] || listMapping[0];
                        console.log('R√©sultat mapp√©:', result);
                        return result;
                    }
                }
                // Par d√©faut
                console.log('‚ö†Ô∏è Aucune slide visible trouv√©e, retour par d√©faut');
                return { key: 'youtubeChannels', class: '.liste1', index: 0 };
            }
            
            // Variable pour √©viter l'initialisation multiple
            let editModeInitialized = false;
            
            // Polling pour attendre que le swiper soit pr√™t
            function waitForSwiper(callback) {
                if (window.swiper && window.swiper.activeIndex !== undefined) {
                    callback();
                } else {
                    setTimeout(() => waitForSwiper(callback), 100);
                }
            }
            
            waitForSwiper(function() {
                if (editModeInitialized) {
                    console.log('‚ö†Ô∏è Edit mode d√©j√† initialis√©, sortie');
                    return;
                }
                editModeInitialized = true;
                console.log('Swiper d√©tect√© et pr√™t');
                
                // Gestion du bouton d'ajout
                const addItemBtn = document.getElementById("addItemBtn");
                addItemBtn.style.display = 'block';
                
                // Gestion du bouton d'√©dition selon la slide active
                const editModeBtn = document.getElementById("editModeBtn");
                editModeBtn.addEventListener("click", () => {
                    const current = getVisibleList();
                    console.log('Toggle edit mode sur:', current.key, 'index:', current.index);
                    toggleEditMode(current.key, current.class);
                });
            });
        </script>
        <input type="file" id="importFile" accept=".json" style="display: none;">
        <!-- Bouton Settings -->
        <div id="settingsBtn" class="BPsetting">‚öôÔ∏è</div>
        <!-- Menu de r√©glages (cach√© par d√©faut) -->
        <div id="settingsMenu">
            <div class="menuContent">
                <div id="exportBtn" class="BPexport" onclick="exportDB()">üíæ</div>
                <div id="importBtn" class="BPimport">üóÇÔ∏è</div>
            </div>
        </div>
        <script>
            document.getElementById("importFile").addEventListener("change", function () {
                if (this.files.length > 0) {
                    importAndReplaceDB(this.files[0]);
                }
            });
            document.getElementById("importBtn").addEventListener("click", () => {
                document.getElementById("importFile").click();
            });
            
            const settingsBtn = document.getElementById("settingsBtn");
            const settingsMenu = document.getElementById("settingsMenu");
            
            settingsBtn.addEventListener("click", (e) => {
              settingsMenu.classList.add("active");
              e.stopPropagation();
            });
            
            settingsMenu.addEventListener("click", (e) => {
                settingsMenu.classList.remove("active");
            });
        </script>        
    </body>
</html>